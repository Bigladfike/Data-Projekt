<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anime Datavisualisering</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.js"></script>
  <script>
let animeData = [];
let loaded = false;
let loadButton;
let trailerIframe = null; // HTML-element til at vise traileren

function setup() {
  createCanvas(1920, 5500);
  background(30);

  // Opret knap
  loadButton = createButton('Hent anime-data').position(20, 20).mousePressed(loadData);

  // Starttekst på canvas
  fill(255);
  textAlign(CENTER, CENTER);
  textSize(24);
  text("Klik på knappen for at hente data", width / 2, height / 2);
}

function draw() {
  if (loaded) {
    displayData(); // Vis data, når de er hentet
  }
}

function loadData() {
  let url = 'https://api.jikan.moe/v4/seasons/now?sfw';
  loadJSON(url, gotData); // Hent data fra API
}

function gotData(data) {
  animeData = data.data.map(anime => ({
    title: anime.title || anime.title_english || "Unknown Title",
    image_url: anime.images.jpg.image_url, // Billedets URL
    genre: anime.genres.map(genre => genre.name).join(', '), // Genre som en streng
    type: anime.type, // Type (f.eks. TV, OVA)
    source: anime.source, // Kilde (f.eks. Manga, Light Novel)
    status: anime.status, // Status (f.eks. Ongoing)
    popularity: anime.popularity, // Popularitet
    favorites: anime.favorites, // Antal favoritter
    releaseDate: anime.aired?.from || "Unknown", // Udgivelsesdato
    trailer_url: anime.trailer?.embed_url || null, // Trailer-URL
    img: loadImage(anime.images.jpg.image_url) // Hent billedet direkte
  }));

  loaded = true; // Marker data som hentet
  background(30); // Ryd canvas efter klik
}

function displayData() {
  background(30); // Ryd canvas før ny visualisering
  fill(255);
  textAlign(CENTER, TOP);
  textSize(12);

  let cols = 3; // Antal kolonner
  let colWidth = width / cols; // Bredden af hver kolonne
  let x = colWidth / 2; // Start x-position (midt i første kolonne)
  let y = 450; // Start y-position for første række

  for (let i = 0; i < animeData.length; i++) {
    let anime = animeData[i];

    // Vis billede, hvis det er hentet
    if (anime.img) {
      image(anime.img, x - 100, y - 300, 200, 275); // Billede (100x100 px) over teksten
    }

    // Vis anime-oplysninger
    text(anime.title, x, y + 30); // Titel
    text(`Genre: ${anime.genre}`, x, y + 50); // Genre
    text(`Type: ${anime.type}`, x, y + 70); // Type
    text(`Source: ${anime.source}`, x, y + 90); // Kilde
    text(`Status: ${anime.status}`, x, y + 110); // Status
    text(`Popularity: ${anime.popularity}`, x, y + 130); // Popularitet
    text(`Favorites: ${anime.favorites}`, x, y + 150); // Favoritter
    text(`Udgivelsesdato: ${anime.releaseDate}`, x, y + 170); // Udgivelsesdato

    // Gem billedets position og dimensioner
    anime.x = x - 50;
    anime.y = y - 80;
    anime.width = 100;
    anime.height = 100;

    // Flyt til næste kolonne
    x += colWidth;
    if (x > width) { // Hvis vi når slutningen af en række
      x = colWidth / 2; // Tilbage til første kolonne
      y += 550; // Flyt til næste række
    }
  }
}

function mousePressed() {
  // Fjern eksisterende trailer, hvis der klikkes et andet sted
  if (trailerIframe) {
    trailerIframe.remove();
    trailerIframe = null;
  }

  // Tjek, om der er klikket på et billede
  for (let anime of animeData) {
    if (
      mouseX > anime.x &&
      mouseX < anime.x + anime.width &&
      mouseY > anime.y &&
      mouseY < anime.y + anime.height
    ) {
      if (anime.trailer_url) {
        // Opret en iframe til traileren
        trailerIframe = createElement('iframe');
        trailerIframe.attribute('src', anime.trailer_url);
        trailerIframe.attribute('width', '560');
        trailerIframe.attribute('height', '315');
        trailerIframe.attribute('allow', 'autoplay; encrypted-media');
        trailerIframe.position(anime.x + 50, anime.y + 80); // Placér over billedet
      }
    }
  }
}

  </script>
</head>
<body>
</body>
</html>
